<!DOCTYPE HTML>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Tom Smith - MSc Cybersecurity</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<a href="../index.html" class="logo"><strong>Tom Smith</strong> <span>MSc Cybersecurity</span></a>
						<nav>
							<a href="#menu">Menu</a>
						</nav>
					</header>

				<!-- Menu -->
					<nav id="menu">
						<ul class="links">
							<li><a href="../index.html">Home</a></li>
							<li><a href="../landing.html">Launching into Cybersecurity</a></li>
						</ul>
						<ul class="actions stacked">
							<li><a href="../elements.html" class="button primary fit">About Me</a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main" class="alt">

						<!-- Banner -->
							<section id="banner" class="style2">
								<div class="inner">
									<header class="major">
										<h1>Induction Computing</h1>
									</header>
									<div class="content">
										<p><span class="image left"><img src="../images/MSc induction.jpg" alt="" /></span>Apart from getting familiar with the learning environment, and understanding policies and techniques, this module was geared around the induction assignment shown below.</p>
									</div>
								</div>
							</section>
						<!-- One -->
							<section id="one">
								<div class="inner">
									<pre>
                                        <code>
                                            """EMA_code.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1U8jpn8iVpbtwaQPd6rBPXGn9ELXLhTtH

Encrypt/Decrypt
"""

import rsa # for rsa encryption/decryption/signing
import os.path # for checking files exist
import pytest # for catching exceptions is false tests
from sympy import gcd, mod_inverse, isprime # for using the rsa algorithm to verify keys are generated properly

# Generates a new public/private key pair.
public_key, private_key = rsa.newkeys(2048)

# TCA01 - Test Case 1: Confirm that the keys are generated
print("TCA01 - Test Case 1: Confirm that the keys are generated - Results:")
if private_key is not None and public_key is not None:
  print(f"Pass: The keys have been generated. \nThe private key is: {private_key} \nThe public key: is {public_key}")
else:
  print("Fail: The keys have not been generated.")

# TCA02 - Test Case 2: Confirm that the keys are properly formatted
print("TCA02 - Test Case 2: Confirm that the keys are properly formatted - Results:")

n, e = public_key.n, public_key.e # n is the modulus and e is the exponent
d, p, q = private_key.d, private_key.p, private_key.q # d is the modular inverse of e, and p and q are the prime factors of n

# checks that the keys are a valid pair
if gcd(e, (p-1)*(q-1)) == 1 and (e * d) % ((p-1)*(q-1)) == 1:
  print("Pass: the public and private keys are consistent.")
else:
  print("Fail: the public and private keys do no match.")

# checks that the modulus is long enough to be secure
if n.bit_length() >= 2048:
  print("Pass: the modulus is sufficiently large.")
else:
  print("Fail: the modulus size is not sufficiently large.")

# checks that the factors cannot be broken down into smaller places as this would make the encryption easier to crack
if isprime(p) and isprime(q):
  print("Pass: the factors of the modulus are prime.")
else:
  print("Fail: the factors of the modulus are not prime.")

# checks that the private key will be able to decrypt the encryption
if d == mod_inverse(e, (p-1)*(q-1)):
  print("Pass: the private exponent is consistent with the modulus.")
else:
  print("Fail: the private exponent is not consistent with the modulus.")

# Creates files for the public and private keys and writes them to it for later use.
with open("public.pem", "wb") as f:
   f.write(public_key.save_pkcs1("PEM"))

with open("private.pem", "wb") as f:
   f.write(private_key.save_pkcs1("PEM"))

# TCA03 - Test Case 3: Confirm that the files have been generated, are the correct file format, and contain the keys
print("TCA03 - Test Case 3: Confirm that the files have been generated, are the correct file format, and contain the keys - Results")

for key in ["public.pem", "private.pem"]:
  if os.path.isfile(key):
    print(f"Pass: {key} file exists.")
  else:
    print(f"Fail: {key} file does not exist.")

with open("public.pem", "rb") as f:
  if public_key == rsa.PublicKey.load_pkcs1(f.read()):
    print(f"Pass: public.pem contains the public key.")
  else:
    print(f"Fail: public.pem does not match the public key.")

with open("private.pem", "rb") as f:
  if private_key == rsa.PrivateKey.load_pkcs1(f.read()):
    print(f"Pass: private.pem contains the private key.")
  else:
    print(f"Fail: private.pem does not match the private key.")

# Sets the message and then encrypt it using the public key
message = "this is the message"
encrypted_message = rsa.encrypt(message.encode(), public_key)

#TCA04 - Test Case 4: Confirm that the encrypted message is not the same as the message.
print("TCA04 - Test Case 4: Confirm that the encrypted message is not the same as the message - Results:")

if message == encrypted_message:
  print("Fail: message and encrypted message are the same.")
else:
  print(f"Pass: message has been changed. \nThe encrypted message is {encrypted_message}")

# Creates a file for the encrypted message and writes it to it for later use.
with open("encrypted.message", "wb") as f:
  f.write(encrypted_message)

# TCA05 - Test Case 5: Confirm that the file has been generated, is the correct format and contains the encrypted message.
print("TCA05 - Test Case 5: Confirm that the file has been generated, is the correct format and contains the encrypted message - Results:")
if os.path.isfile("encrypted.message"):
  print("Pass: encrypted.message exists.")
else:
  print("Fail: encrypted.message does not exist.")

if encrypted_message == open("encrypted.message", "rb").read():
  print("Pass: encrypted.message contains the encrypted message")
else:
  print("Fail: encrypted.message does not contain the encrypted message")

# Decrypts the message from the file it is stored in using the private key

decrypted_message = rsa.decrypt(open("encrypted.message", "rb").read(), private_key)

# TCA06 - Test Case 6: Confirm that the message has been decrypted back to original
print("TCA06 - Test Case 6: Confirm that the message has been decrypted back to original - Results:")

if decrypted_message.decode() == message:
  print(f"Pass: message has been successfully decrypted. \nOriginal message: {message}\nDecrypted message: {decrypted_message.decode()}")
else:
  print(f"Fail: message decrypted unsuccessfully. \nOriginal message: {message}\nDecrypted message: {decrypted_message}")

# TCA07 - Test Case 7: Confirm that the message cannot be decrypted with another key.
print("TCA07 - Test Case 7: Confirm that the message cannot be decrypted with another key - Results:")

# Generates another public/private key pair for testing.
public_key_wrong, private_key_wrong = rsa.newkeys(1024)

# Uses the wrong key to attempt to decrypt the message.
with pytest.raises(Exception, match='Decryption failed'):
  rsa.decrypt(encrypted_message, private_key_wrong)

print("Pass: the wrong private key has not decrypted the message")

"""Signature Generation"""

# The message to be verified.
message_unsigned = "I am studying cyber security"

# Hashes the message with SHA-256 and then signs the hash with the private key.
message_signed = rsa.sign(message_unsigned.encode(), private_key, "SHA-256")

# TCA08 - Test Case 8: Confirm that signature has been generated.
print("TCA08 - Test Case 8: Confirm that signature has been generated - Results:")

if message_signed is not None:
  print(f"Pass: signature has been generated. \nThe signature is: {message_signed}")
else:
  print("Fail: signature has not been generated.")

# Generates a file for the signature and writes it to it for later use.
with open("signature", "wb") as f:
  f.write(message_signed)

# TCA09 - Test Case 9: Confirm that the file has been generated, and contains the signed message.
print("TCA09 - Test Case 9: Confirm that the file has been generated, and contains the signed message - Results:")
if os.path.isfile("signature"):
  print("Pass: signature file exists.")
else:
  print("Fail: signature file does not exist.")

if message_signed == open("signature", "rb").read():
  print("Pass: signature file contains the signature.")
else:
  print("Fail: signature file does not contain the signature.")

# TCA10 - Test Case 10: Confirm that the public key can verify the message using the signature
print("TCA10 - Test Case 10: Confirm that the public key can verify the message using the signature - Results:")

if rsa.verify(message_unsigned.encode(), message_signed, public_key) == "SHA-256":
  print("Pass: the message was verified using the signature and public key.")
else:
  print("Fail: the message could not be verified using the signature and public key.")

# TCA11 - Test Case 11: Confirm that the wrong message cannot be verified.
print("TCA11 - Test Case 11: Confirm that the wrong message cannot be verified - Results:")

message_wrong = "This is the fake message"

# catches the error and presents a pass for testing cleanliness
with pytest.raises(Exception, match='Verification failed'):
  rsa.verify(message_wrong.encode(), message_signed, public_key)

print("Pass: the wrong message could not be verified using the signature and public key.")

# TCA12 - Test Case 12: Confirm that the wrong public key does not verify the message.
print("TCA12 - Test Case 12: Confirm that the wrong public key does not verify the message - Results:")

# catches the error and presents a pass for testing cleanliness
with pytest.raises(Exception, match='Verification failed'):
  rsa.verify(message_unsigned.encode(), message_signed, public_key_wrong)

print("Pass: the message could not be verified using the right signature but wrong public key.")

# TCA13 - Test Case 13: Confirm that the wrong signature does not verify the message.
print("TCA13 - Test Case 13: Confirm that the wrong signature does not verify the message - Results:")

message_signed_wrong = rsa.sign(message_unsigned.encode(), private_key_wrong, "SHA-256")

# catches the error and presents a pass for testing cleanliness
with pytest.raises(Exception, match='Verification failed'):
  rsa.verify(message_unsigned.encode(), message_signed_wrong, public_key)

print("Pass: the wrong message could not be verified using the right public key but wrong signature.")
                                        </code>
                                    </pre>
								</div>
							</section>
					</div>

				<!-- Footer -->
					<footer id="footer">
						<div class="inner">
							<ul class="icons">
								<li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
								<li><a href="#" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
								<li><a href="#" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
								<li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
								<li><a href="#" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
							</ul>
							<ul class="copyright">
								<li>&copy; Untitled</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</footer>

			</div>

		<!-- Scripts -->
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/jquery.scrolly.min.js"></script>
			<script src="../assets/js/jquery.scrollex.min.js"></script>
			<script src="../assets/js/browser.min.js"></script>
			<script src="../assets/js/breakpoints.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<script src="../assets/js/main.js"></script>

	</body>
</html>